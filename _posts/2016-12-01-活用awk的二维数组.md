---
layout: post
category : lessons
tagline: ""
tags : [shell]
---
{% include JB/setup %}

最近用AWK命令分析了一段文本,特此记录

### 数据格式
```
201607_10_1
201605_20_1
201604_20_0
201604_20_1
201605_30_1
201607_10_0
201607_10_1
201607_10_0
```

- 分隔符(_)的第一列代表日期
- 第二列代表编号
- 第三列代表标志位


### 需求

获取每个月,每个编号的总记录数和标志位等于1的记录数
最终的结果应该是:

```
10_201607_3_2
20_201604_2_1
20_201605_1_1
30_201605_1_1
```

### 实现

```
 cat data.log |awk -F"_" '{p[$2,$1]++;if ($3==1){s[$2,$1]++;}}END{ for (k in p) {split(k,qidarr,SUBSEP); print qidarr[1]"_"qidarr[2]"_"p[qidarr[1],qidarr[2]]"_"s[qidarr[1],qidarr[2]] }}' | sort -k 1,2 
 ```

