---
layout: post
category : lessons
tagline: ""
tags : [mysql]
---
{% include JB/setup %}

前一段时间使用SecureCRT连接公司服务器，通过mysql命令行操作数据库表，发现查询出现乱码。

排查发现，SecureCRT 终端配置的是 UTF-8 ，服务器上 locale 显示的是 UTF-8 ，通过`show variables like '%character%'`发现库表字段设置也是 UTF-8 ，最终通过`mysql  --print-defaults`发现 mysql 客户端发送的查询字符集是空不是 UTF-8 。
 
可以通过下面二种方法临时解决：
第一种方法通过 mysql 命令行连接后，发送`SET NAMES 'utf8'`命令。
第二种方法是`mysql default-character-set=utf-8`指定字符集连接数据库。

#### 根本解决方法
mysqld 安装的时候一般会读取 my.cnf ，同理 mysql 客户端也读取 my.cnf ，可以通过在 my.cnf 中配置``default-character-set`参数来保证 mysql 连接的时候发送 UTF-8 字符集。

按照惯例 my.cnf 保存在 /etc/mysql/my.cnf,/etc/my.cnf，~/.my.cnf 中,由于服务器是 CentOS 操作系统，所以可以使用`rpm`查询`my.cnf`所在位置
 
```
whereis mysql  #查询 mysql 命令行实际路径 /usr/bin/mysql
rpm -qf /usr/bin/mysql #查询 mysql 是那个安装包安装的
rpm -qc mysql-5.1.71-1.el6.x86_64 #查询 mysql 安装后的配置文件，没有发现 my.cnf
rpm -qR mysql-5.1.71-1.el6.x86_64 #查询 mysql 安装包依赖的包，重点关注 mysql-libs
rpm -qc mysql-libs #发现 /etc/my.cnf 位置
```

修改 /etc/my.cnf 配置解决问题：

```
[client]
default-character-set=utf8
```
