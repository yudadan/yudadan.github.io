---
layout: post
category : lessons
tagline: ""
tags : [php]
---
{% include JB/setup %}

#### SEO 优化

（1）主要就是 author、title、keyword、description 标签的使用。

（2）robots.txt 和 robot meta 标签能够控制机器人的行为。

#### Nginx.conf 相关配置

（1）[deny 指令](http://nginx.org/en/docs/http/ngx_http_access_module.html#deny)，防止某些 IP 或全部 IP 访问，一般和 location 指令配合

（2）[location 指令](http://nginx.org/en/docs/http/ngx_http_core_module.html#location) 主要是为了匹配 URL 并进行处理

假如不允许用户访问特定的目录，可以结合 deny 和 location 指令：

```
location ~* ^/(data|session|\.git|\.composer.json)/ {
     deny all;
}
```

(3) 通过 expires 和 add_header [指令](http://nginx.org/en/docs/http/ngx_http_headers_module.html) 配置缓存时间，比如：

```
location ~*  \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 10d;
    add_header Cache-Control "no-cache,must-revalidate,max-age=0";
    log_not_found off;
}
```

(4) [try_files 指令](http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files)，非常有趣的一个指令，按照顺序寻找路径或者目录，假如找到则直接返回，假如没有找到最后可以执行一定的动作（比如重定向），比如，假如没有找到 $uri 文件或者 $uri 目录则重定向到 index.php

```
location / {
    try_files $uri $uri/ /index.php;
}
```

（5）rewrite 指令

last 与 break 的区别：

- last - completes processing of rewrite directives, after which searches for corresponding URI and location
- break - completes processing of rewrite directives and breakes location lookup cycle by not doing any location lookup and internal jump at all

last 匹配后，会重新搜索并匹配新的 URL，而 break 在匹配后，不会进行 rewrite 指令的搜索，也不会处理内部的跳转（通俗的说，不会再进行 rewrite 的匹配，但是会执行其他的指令）。

一个注意点：

If a regular expression includes the “}” or “;” characters, the whole expressions should be enclosed in single or double quotes.（假如正则中包含 } 和 ; 符号，则整个正则表达式应该用引号括起来）

```
rewrite "^/js/([a-z0-9]{5})$" /rss.php?a=js&u=$1 last;
```

避免死循环：

```
location /download/ {
    rewrite ^(/download/.*)/media/(.*)\..*$ $1/mp3/$2.mp3 break;
    rewrite ^(/download/.*)/audio/(.*)\..*$ $1/mp3/$2.ra  break;
    return  403;
}
```

#### PHP 代码

(1) 将一个本地时间转换为 GMT 时间

```
date_default_timezone_set("Asia/Chongqing");
$dateTimeZoneChina = new \DateTimeZone("Asia/Chongqing");
$datetime = date("Y-m-d H:i:s");
$datetimeObj       = new \DateTime($datetime, $dateTimeZoneChina);
$datetimeObj->setTimezone(new DateTimeZone('GMT'));
echo $datetimeObj->format('Y-m-d H:i:s')."\n";
```

（2）smarty [处理](http://www.smarty.net/docs/zh_CN/installing.smarty.basic.tpl)

```
$smarty                 = new Smarty;
$smarty->debugging      = false;
$smarty->caching        = false;
$smarty->cache_lifetime = 120;
$dir = $_SERVER["DOCUMENT_ROOT"]."/smarty";
$smarty->setTemplateDir($dir.'/template/');
$smarty->setCompileDir($dir.'/templates_c/');
$smarty->setConfigDir($dir.'/configs/');
$smarty->setCacheDir($dir.'/cache/');
```